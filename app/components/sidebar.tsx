import { useEffect, useRef, useMemo } from "react";

import styles from "./home.module.scss";

import { IconButton } from "./button";
import SettingsIcon from "../icons/settings.svg";
import GithubIcon from "../icons/github.svg";
import ChatGptIcon from "../icons/chatgpt.svg";
import AddIcon from "../icons/add.svg";
import CloseIcon from "../icons/close.svg";
import DeleteIcon from "../icons/delete.svg";
import MaskIcon from "../icons/mask.svg";
import PluginIcon from "../icons/plugin.svg";
import DragIcon from "../icons/drag.svg";
import BiliBiliIcon from "../icons/bilibili.svg";

import Locale from "../locales";

import { useAppConfig, useChatStore } from "../store";

import {
  DEFAULT_SIDEBAR_WIDTH,
  MAX_SIDEBAR_WIDTH,
  MIN_SIDEBAR_WIDTH,
  NARROW_SIDEBAR_WIDTH,
  Path,
  REPO_URL,
} from "../constant";

import { Link, useNavigate } from "react-router-dom";
import { isIOS, useMobileScreen } from "../utils";
import dynamic from "next/dynamic";
import { showConfirm, showToast } from "./ui-lib";

const ChatList = dynamic(async () => (await import("./chat-list")).ChatList, {
  loading: () => null,
});

function useHotKey() {
  const chatStore = useChatStore();

  useEffect(() => {
    const onKeyDown = (e: KeyboardEvent) => {
      if (e.altKey || e.ctrlKey) {
        if (e.key === "ArrowUp") {
          chatStore.nextSession(-1);
        } else if (e.key === "ArrowDown") {
          chatStore.nextSession(1);
        }
      }
    };

    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
  });
}

function useDragSideBar() {
  const limit = (x: number) => Math.min(MAX_SIDEBAR_WIDTH, x);

  const config = useAppConfig();
  const startX = useRef(0);
  const startDragWidth = useRef(config.sidebarWidth ?? DEFAULT_SIDEBAR_WIDTH);
  const lastUpdateTime = useRef(Date.now());

  const toggleSideBar = () => {
    config.update((config) => {
      if (config.sidebarWidth < MIN_SIDEBAR_WIDTH) {
        config.sidebarWidth = DEFAULT_SIDEBAR_WIDTH;
      } else {
        config.sidebarWidth = NARROW_SIDEBAR_WIDTH;
      }
    });
  };

  const onDragStart = (e: MouseEvent) => {
    // Remembers the initial width each time the mouse is pressed
    startX.current = e.clientX;
    startDragWidth.current = config.sidebarWidth;
    const dragStartTime = Date.now();

    const handleDragMove = (e: MouseEvent) => {
      if (Date.now() < lastUpdateTime.current + 20) {
        return;
      }
      lastUpdateTime.current = Date.now();
      const d = e.clientX - startX.current;
      const nextWidth = limit(startDragWidth.current + d);
      config.update((config) => {
        if (nextWidth < MIN_SIDEBAR_WIDTH) {
          config.sidebarWidth = NARROW_SIDEBAR_WIDTH;
        } else {
          config.sidebarWidth = nextWidth;
        }
      });
    };

    const handleDragEnd = () => {
      // In useRef the data is non-responsive, so `config.sidebarWidth` can't get the dynamic sidebarWidth
      window.removeEventListener("pointermove", handleDragMove);
      window.removeEventListener("pointerup", handleDragEnd);

      // if user click the drag icon, should toggle the sidebar
      const shouldFireClick = Date.now() - dragStartTime < 300;
      if (shouldFireClick) {
        toggleSideBar();
      }
    };

    window.addEventListener("pointermove", handleDragMove);
    window.addEventListener("pointerup", handleDragEnd);
  };

  const isMobileScreen = useMobileScreen();
  const shouldNarrow =
    !isMobileScreen && config.sidebarWidth < MIN_SIDEBAR_WIDTH;

  useEffect(() => {
    const barWidth = shouldNarrow
      ? NARROW_SIDEBAR_WIDTH
      : limit(config.sidebarWidth ?? DEFAULT_SIDEBAR_WIDTH);
    const sideBarWidth = isMobileScreen ? "100vw" : `${barWidth}px`;
    document.documentElement.style.setProperty("--sidebar-width", sideBarWidth);
  }, [config.sidebarWidth, isMobileScreen, shouldNarrow]);

  return {
    onDragStart,
    shouldNarrow,
  };
}

export function SideBar(props: { className?: string }) {
  const chatStore = useChatStore();

  // drag side bar
  const { onDragStart, shouldNarrow } = useDragSideBar();
  const navigate = useNavigate();
  const config = useAppConfig();
  const isMobileScreen = useMobileScreen();
  const isIOSMobile = useMemo(
    () => isIOS() && isMobileScreen,
    [isMobileScreen],
  );

  useHotKey();

  return (
    <div
      className={`${styles.sidebar} ${props.className} ${
        shouldNarrow && styles["narrow-sidebar"]
      }`}
      style={{
        // #3016 disable transition on ios mobile screen
        transition: isMobileScreen && isIOSMobile ? "none" : undefined,
      }}
    >
      <div className={styles["sidebar-header"]} data-tauri-drag-region>
        <div className={styles["sidebar-title"]} data-tauri-drag-region>
          AI Chat
        </div>
        <div className={styles["sidebar-sub-title"]}>
          听从我心，无问西东.
        </div>
        <div className={styles["sidebar-logo"] + " no-dark"}>
          <ChatGptIcon />
        </div>
      </div>

      <div className={styles["sidebar-header-bar"]}>
        <IconButton
          icon={<MaskIcon />}
          text={shouldNarrow ? undefined : Locale.Mask.Name}
          className={styles["sidebar-bar-button"]}
          onClick={() => {
            if (config.dontShowMaskSplashScreen !== true) {
              navigate(Path.NewChat, { state: { fromHome: true } });
            } else {
              navigate(Path.Masks, { state: { fromHome: true } });
            }
          }}
          shadow
        />
        <IconButton
          icon={<PluginIcon />}
          text={shouldNarrow ? undefined : Locale.Plugin.Name}
          className={styles["sidebar-bar-button"]}
          onClick={() => showToast(Locale.WIP)}
          shadow
        />
      </div>

      <div
        className={styles["sidebar-body"]}
        onClick={(e) => {
          if (e.target === e.currentTarget) {
            navigate(Path.Home);
          }
        }}
      >
        <ChatList narrow={shouldNarrow} />
      </div>

      <div className={styles["sidebar-tail"]}>
        <div className={styles["sidebar-actions"]}>
          <div className={styles["sidebar-action"] + " " + styles.mobile}>
            <IconButton
              icon={<DeleteIcon />}
              onClick={async () => {
                if (await showConfirm(Locale.Home.DeleteChat)) {
                  chatStore.deleteSession(chatStore.currentSessionIndex);
                }
              }}
            />
          </div>
          <div className={styles["sidebar-action"]}>
            <Link to={Path.Settings}>
              <IconButton icon={<SettingsIcon />} shadow />
            </Link>
          </div>
          <div className={styles["sidebar-action"]}>
            <a href={REPO_URL} target="_blank" rel="noopener noreferrer">
              <IconButton icon={<GithubIcon />} shadow />
            </a>
          </div>
          <div className={styles["sidebar-action"]}>
            <a href="https://space.bilibili.com/404213491" target="_blank" rel="noopener noreferrer">
{/*              <svg t="1695619103026" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8766" width="12" height="12"><path d="M299 908.733333c-8.933333-0.933333-17.2-4.133333-22.6-8.8-1.466667-1.266667-3.666667-3-4.866667-3.866666-2-1.4-8.866667-11.933333-8.866666-13.666667 0-0.4-0.4-1.333333-0.933334-2.066667-1.266667-1.8-3.733333-10.866667-3.733333-13.733333 0-3.8-0.8-3.933333-25.933333-3.933333-15.8-0.066667-24.266667-0.333333-28.733334-1-7.533333-1.133333-13.6-2.466667-16.2-3.533334-1.066667-0.466667-2.133333-0.8-2.466666-0.8s-1.6-0.533333-2.8-1.2-3.666667-1.733333-5.466667-2.333333c-1.866667-0.666667-6.266667-2.8-9.8-4.8s-6.866667-3.666667-7.4-3.666667c-0.466667 0-1.266667-0.6-1.733333-1.333333s-1.2-1.333333-1.666667-1.333333c-0.533333 0-1.6-0.733333-2.466667-1.666667s-1.666667-1.533333-1.8-1.4-1.066667-0.4-2-1.2c-1.533333-1.2-4.466667-4.133333-18.866666-18.8-1.466667-1.533333-2.666667-3-2.666667-3.333333s-0.933333-1.466667-2-2.533334-1.8-2.2-1.6-2.466666c0.2-0.333333-0.133333-0.8-0.666667-1-0.6-0.2-1.066667-0.8-1.066666-1.2 0-0.466667-0.733333-1.533333-1.666667-2.4-0.866667-0.8-1.466667-1.733333-1.333333-2 0.333333-0.533333-2.133333-4-3.4-4.866667-0.466667-0.266667-1-1.333333-1.266667-2.4-0.2-1.066667-0.866667-2.333333-1.4-2.8-0.533333-0.4-0.933333-1.133333-0.933333-1.6 0-0.4-1-2.866667-2.266667-5.4-1.2-2.533333-2.733333-5.8-3.4-7.266667s-1.533333-3.133333-2-3.666666c-0.533333-0.533333-1-1.866667-1.133333-3-0.4-2.933333-3.2-11.8-4.2-13.4-0.533333-0.8-0.933333-2-0.933334-2.666667 0-2.133333-0.866667-5.2-1.733333-6.266667-0.466667-0.533333-1-3.666667-1.133333-7.066666-0.2-3.266667-0.8-6.733333-1.266667-7.666667-0.8-1.333333-0.933333-30.066667-1.133333-184.6-0.2-182.466667-0.066667-195.133333 2.066666-200.666667 0.2-0.533333 0.533333-2.466667 0.733334-4.333333 0.466667-5.333333 2.066667-11.2 6.466666-24.4 0.733333-2.066667 1.266667-4.266667 1.266667-4.866667 0-0.666667 0.533333-1.866667 1.2-2.733333 0.666667-0.8 1.6-2.8 2.133333-4.4s1.8-4.4 2.8-6.133333 1.866667-3.533333 1.866667-3.866667c0-0.4 0.6-1.466667 1.333333-2.4s1.333333-2.466667 1.333334-3.333333c0-1.066667 0.466667-1.8 1.333333-2 0.733333-0.2 1.333333-0.733333 1.333333-1.2s0.6-1.6 1.333334-2.533334 1.333333-2.2 1.333333-2.933333c0-0.666667 0.8-1.933333 1.733333-2.8s2.133333-2.466667 2.666667-3.466667c0.533333-1.066667 1.533333-2.2 2.266667-2.6 0.8-0.4 1.333333-1.4 1.333333-2.333333 0-1 0.6-1.933333 1.4-2.4 0.8-0.4 2.333333-1.8 3.533333-3.133333 2.066667-2.4 11.666667-12.066667 15.666667-15.666667 1.133333-1.066667 2.333333-1.733333 2.666667-1.533333 0.333333 0.266667 2-1 3.666666-2.666667s3.466667-2.933333 3.866667-2.8c0.466667 0.2 1.333333-0.333333 2-1.133333 1.333333-1.666667 8.666667-5.666667 10.533333-5.666667 1.466667 0 7.4-2.666667 8.133334-3.666667 0.333333-0.466667 0.533333-0.466667 0.533333 0 0 0.4 0.333333 0.133333 0.733333-0.466666 0.4-0.733333 1.466667-1.2 2.733334-1.2 1.133333 0 2.6-0.466667 3.266666-1.066667s2.266667-1.133333 3.533334-1.266667 2.733333-0.466667 3.2-0.733333c0.4-0.266667 2.133333-0.6 3.866666-0.666667 1.666667-0.066667 6.133333-0.533333 10-1.066666s9.333333-0.866667 12.2-0.733334c3.066667 0.066667 5.133333-0.066667 5.133334-0.466666s3-0.666667 7.333333-0.666667c4.066667 0 7.333333 0.266667 7.333333 0.6 0 0.4 10.133333 0.666667 25.333334 0.666667 15.6 0 25.333333-0.266667 25.333333-0.6 0-0.4 1.066667-0.666667 2.333333-0.666667s2.333333 0.333333 2.333334 0.666667c0 0.4 3 0.666667 7.666666 0.666666s7.666667-0.266667 7.666667-0.666666c0-0.333333 0.6-0.666667 1.4-0.666667 0.733333 0 1.133333 0.266667 0.933333 0.666667-0.266667 0.4 5.466667 0.6 16.6 0.533333 9.4-0.066667 17.066667-0.4 17.066667-0.666667s1.2-0.533333 2.733333-0.533333 2.533333 0.266667 2.266667 0.666667 4.666667 0.533333 13.333333 0.466666c12-0.133333 13.866667-0.266667 14.4-1.266666 0.466667-0.866667-5.666667-7.333333-32.8-34.466667-18.4-18.4-33.666667-33.4-34-33.4s-0.6-0.333333-0.6-0.733333-0.733333-1.666667-1.666666-2.866667c-1.733333-2.333333-4-8.133333-4.6-11.933333-0.2-1.266667-0.533333-2.733333-0.8-3.4-0.4-1.066667 0-3.2 2.266666-11.4 1.066667-4.066667 5.466667-10.333333 7.2-10.333334 0.466667 0 1.2-0.533333 1.533334-1.266666 0.8-1.466667 5.533333-4.066667 7.333333-4.066667 0.666667 0 1.6-0.466667 2.066667-1 1.2-1.4 14.8-1.466667 15.933333-0.066667 0.466667 0.533333 1.8 1.2 2.933333 1.466667 1.2 0.2 3.333333 1.266667 4.8 2.266667 3.066667 2.133333 24.133333 22.933333 25.866667 25.533333 0.666667 1 1.466667 1.8 1.866667 1.8 0.866667 0 14.6 13.8 14.6 14.733333 0 0.333333 0.533333 0.866667 1.2 1.066667 1.333333 0.533333 13.466667 12.666667 13.466666 13.533333 0 0.333333 0.8 1.133333 1.8 1.8 2.733333 1.8 8.866667 7.866667 8.866667 8.733334 0 0.466667 0.266667 0.8 0.666667 0.8 0.866667 0 38.666667 37.733333 38.666666 38.666666 0 0.333333 0.4 0.666667 0.866667 0.666667s1.733333 0.866667 2.8 2c1.066667 1.066667 2.466667 2 3.066667 2 0.666667 0 1.333333 0.266667 1.533333 0.533333 0.533333 0.866667 99.8 0.8 101.4-0.066666 0.733333-0.333333 2.333333-1.533333 3.533333-2.533334 1.2-1.066667 2.533333-1.933333 3-1.933333s1.2-0.933333 1.6-2c0.4-1.133333 1.2-2 1.8-2s1.066667-0.4 1.066667-0.933333 1.533333-2 3.4-3.333334c1.8-1.333333 3.933333-3.4 4.6-4.6 0.733333-1.2 2.8-3.333333 4.6-4.8 1.866667-1.466667 3.533333-3.133333 3.733333-3.733333 0.2-0.533333 1.4-1.533333 2.666667-2.133333 1.4-0.666667 3.266667-2.533333 4.733333-4.8 1.333333-2 2.933333-3.666667 3.533334-3.666667s1.466667-0.866667 1.866666-2c0.4-1.066667 1.2-2 1.733334-2 0.6 0 1.266667-0.6 1.466666-1.333333s1.066667-1.666667 1.866667-2.133334c2.8-1.466667 6.333333-4.666667 6.733333-6.133333 0.266667-0.733333 2.066667-2.733333 4.133334-4.4s4.2-3.8 4.8-4.866667c0.6-1 1.533333-1.933333 2.133333-2.133333 0.533333-0.2 2.2-1.8 3.666667-3.666667 1.466667-1.8 3.133333-3.333333 3.733333-3.333333s1.266667-0.6 1.466667-1.4c0.2-0.733333 1-1.533333 1.733333-1.733333 0.8-0.2 1.4-0.733333 1.4-1.2s1.666667-2.133333 3.666667-3.733334 3.8-3.6 4.066666-4.466666c0.2-0.8 1.933333-2.666667 3.866667-4.133334 1.866667-1.466667 3.6-2.866667 3.866667-3.133333 0.2-0.333333 2.266667-2.466667 4.533333-4.866667s4.6-5 5.133333-5.8c0.6-0.866667 1.4-1.533333 1.8-1.533333s1.333333-0.933333 1.933334-2c0.666667-1.133333 1.533333-2 1.933333-2 0.333333 0 1.266667-0.733333 2-1.666667s1.666667-1.666667 2.2-1.666666c0.466667 0 1-0.6 1.2-1.333334s1.066667-1.6 1.933333-2c0.8-0.333333 2-0.933333 2.533334-1.266666s2.866667-1.4 5.066666-2.333334c3.533333-1.466667 5.066667-1.733333 11.133334-1.733333 3.866667 0 7.2 0.266667 7.4 0.6s1.8 1.266667 3.533333 2.066667 4.133333 2.266667 5.4 3.2c2.8 2.133333 8.266667 10.333333 9 13.466666 2 8.866667 1.066667 16.4-2.933333 22.933334-1.4 2.4-2.6 4.666667-2.6 5 0 0.4-0.333333 0.733333-0.733334 0.733333s-15.733333 15-34.066666 33.333333c-31.333333 31.4-33.2 33.466667-32.133334 34.533334 1 1 3.4 1.133333 22.733334 1.266666 12.8 0.066667 21.533333-0.133333 21.533333-0.533333 0-0.933333 3.2-0.733333 3.533333 0.266667 0.266667 0.6 0.4 0.6 0.4 0 0.066667-0.533333 1.066667-0.866667 2.8-0.866667 1.466667 0 2.533333 0.266667 2.333334 0.6-0.2 0.266667 7.266667 0.533333 16.6 0.533333s17-0.2 17-0.533333 2.133333-0.6 4.733333-0.6c2.533333 0 4.533333 0.266667 4.333333 0.533333-0.2 0.333333 4.866667 0.6 11.266667 0.666667 6.8 0 11.666667-0.2 11.666667-0.6 0-0.333333 1.2-0.6 2.733333-0.6 1.466667 0 2.533333 0.266667 2.333333 0.533333-0.133333 0.266667 8.866667 0.6 20.133334 0.666667s22.733333 0.4 25.466666 0.8c5.4 0.733333 15.466667 2.466667 16 2.666667 0.2 0.066667 0.533333 0.133333 0.866667 0.066666 0.266667 0 0.466667 0.2 0.466667 0.533334s1 0.8 2.2 1c1.133333 0.2 3 0.866667 4 1.4s2.266667 0.8 2.733333 0.6 1.333333 0.133333 1.933333 0.666666c0.533333 0.533333 1.2 0.8 1.4 0.533334 0.266667-0.2 0.666667-0.133333 0.933334 0.2 0.666667 0.933333 3.266667 2.333333 4.4 2.333333 0.466667 0 1.733333 0.666667 2.733333 1.466667 1.066667 0.8 2.4 1.533333 3.066667 1.666666 1.533333 0.2 11.933333 7.466667 11.933333 8.266667 0 0.4 0.266667 0.533333 0.6 0.266667 0.4-0.2 1.466667 0.666667 2.533333 2 1 1.266667 2.4 2.333333 3.066667 2.333333 0.733333 0 1.4 0.6 1.6 1.333333s0.733333 1.333333 1.266667 1.333334c0.466667 0 1.333333 0.733333 1.933333 1.533333 0.533333 0.866667 1.733333 2 2.666667 2.466667s1.666667 1.266667 1.666666 1.733333c0 0.4 1.933333 2.6 4.333334 4.866667 2.4 2.2 4.333333 4.4 4.333333 4.866666s1.466667 2.4 3.2 4.266667 3.6 4.266667 4.133333 5.333333 1.4 2.2 1.8 2.466667c0.466667 0.266667 0.866667 0.933333 0.866667 1.333333 0 0.466667 1.333333 2.933333 3 5.4 1.666667 2.533333 3 4.733333 3 4.866667s0.733333 1.866667 1.6 3.733333c4.6 10 7.2 15.933333 7.333333 16.666667 0.133333 0.466667 0.4 1.266667 0.6 1.8 1.133333 2.666667 2.466667 7.266667 2.866667 9.866667 0.266667 1.533333 0.666667 2.8 1 2.8s0.6 0.6 0.6 1.333333 0.4 2.466667 0.933333 3.8c0.533333 1.4 1.133333 4.066667 1.266667 5.866667 0.2 1.866667 0.8 5.466667 1.4 8 2.4 10.733333 2.466667 17.8 2.2 198.333333-0.2 97.333333-0.466667 178.2-0.666667 179.666667s-0.6 4.466667-0.8 6.666666-0.866667 5.666667-1.4 7.733334c-0.466667 2.066667-0.933333 4.733333-0.933333 5.8 0 1.133333-0.866667 4.466667-2 7.466666-1.066667 3-2 6-2 6.733334s-0.6 2.733333-1.266667 4.466666c-0.733333 1.733333-2.133333 5.266667-3.066666 7.8-2.2 5.8-9.066667 19.533333-12.066667 24.133334-1.266667 1.866667-2.266667 3.666667-2.266667 3.933333s-1 1.666667-2.2 3.2-2.666667 3.466667-3.266666 4.4-1.666667 2.333333-2.466667 3.133333-1.4 2.066667-1.4 2.733334-0.8 1.666667-1.733333 2.2c-1 0.533333-3.4 2.8-5.333334 5.133333-2 2.266667-5.8 5.933333-8.466666 8.133333-2.733333 2.133333-5.266667 4.4-5.8 4.933334-0.466667 0.6-1.2 1.066667-1.666667 1.066666-0.533333 0-1.466667 0.733333-2.2 1.666667s-1.533333 1.666667-1.8 1.666667c-0.333333 0-1.466667 0.733333-2.6 1.6s-2.733333 1.733333-3.533333 2c-0.866667 0.266667-1.533333 0.8-1.533334 1.133333s-0.333333 0.6-0.8 0.6c-0.4 0-2.6 1.2-4.8 2.6-2.266667 1.466667-5.066667 2.8-6.333333 3.066667-1.2 0.266667-3.6 1.133333-5.333333 2-1.666667 0.8-4.533333 1.866667-6.4 2.333333-1.8 0.4-3.933333 1.066667-4.666667 1.333333-0.733333 0.333333-2.2 0.733333-3.333333 0.933334-1.066667 0.133333-3.333333 0.666667-5 1.066666-1.866667 0.466667-12.933333 0.933333-28.666667 1.2l-25.666667 0.466667-0.4 4.333333c-0.266667 2.4-0.733333 5.2-1.2 6.2-0.4 1.066667-0.733333 2.8-0.733333 3.933334 0 1.2-0.8 3-2 4.533333-1.066667 1.4-2 2.8-2 3.2 0 1.266667-6.733333 10.8-7.666667 10.8-0.466667 0-1.866667 1.133333-3.133333 2.533333-1.2 1.333333-3 2.8-3.866667 3.266667-0.933333 0.466667-3.266667 1.733333-5.2 2.866667-1.933333 1.066667-4.066667 2-4.666666 2s-1.933333 0.4-2.933334 0.933333c-2.266667 1.2-20 2.2-22.066666 1.266667-0.8-0.4-3.066667-1.066667-5.066667-1.533334s-4.6-1.466667-5.866667-2.133333c-1.2-0.733333-2.2-1.066667-2.2-0.8s-0.666667-0.066667-1.466666-0.8c-0.866667-0.733333-2.8-2.133333-4.333334-3.133333-1.6-1-2.866667-2.133333-2.866666-2.533334 0-0.333333-1.066667-1.133333-2.333334-1.666666-1.4-0.533333-2.333333-1.4-2.333333-2.133334 0-0.6-0.933333-2-2-3.066666-1.133333-1.066667-2-2.333333-2-2.733334 0-0.466667-0.866667-2.066667-2-3.533333-1.066667-1.533333-2-3.466667-2-4.333333s-0.4-2.466667-0.933333-3.533334c-1-2.066667-1.6-4.533333-2.2-9.733333-0.266667-2.533333-0.6-3.2-1.6-3.2-0.733333 0-1.266667-0.266667-1.266667-0.666667 0-0.466667-54.6-0.6-160.8-0.466666l-160.733333 0.133333-1.2 5c-0.666667 2.733333-1.266667 5.6-1.266667 6.4 0 0.733333-0.466667 1.933333-1 2.666667-0.533333 0.666667-1 2-1 2.866666 0 1.8-4.4 9-7 11.4-0.933333 0.866667-1.666667 2.133333-1.666667 2.733334 0 0.666667-0.666667 1.6-1.466666 2-0.866667 0.466667-2.266667 1.666667-3.133334 2.666666-0.866667 1.066667-2 1.933333-2.466666 1.933334-0.533333 0-1.466667 0.533333-2.133334 1.2-1.466667 1.4-9.066667 5.2-11.8 5.8-5.666667 1.333333-12.533333 1.733333-19.333333 1.066666z m490.733333-130.8c0.266667-0.466667 1.8-0.666667 4.2-0.466666 5.733333 0.533333 11.8-1.866667 18.533334-7.266667 1.533333-1.2 3.133333-2.2 3.666666-2.266667 0.466667 0 2.466667-1.866667 4.4-4.133333 3.6-4.2 4.6-5.733333 6.466667-9.6 0.533333-1.2 1.266667-2.2 1.533333-2.2 0.8 0 3.466667-6.4 3.466667-8.466667 0-1.066667 0.466667-2.533333 1-3.266666 2.733333-3.933333 2.666667 0.666667 2.6-193.266667 0-188.466667-0.066667-192.6-2.266667-195.333333-0.333333-0.333333-0.733333-1.866667-1-3.333334-0.6-3.6-2.066667-6.733333-3.4-7.266666-0.6-0.266667-0.933333-0.866667-0.666666-1.4 0.2-0.533333 0.066667-1-0.333334-1s-0.533333-0.266667-0.333333-0.6c0.933333-1.466667-14.666667-18.066667-16.933333-18.066667-0.4 0-0.666667-0.2-0.666667-0.533333 0-0.266667-2.066667-1.2-4.666667-2.066667-2.533333-0.866667-4.666667-1.8-4.666666-2.066667 0-0.333333-1.133333-0.733333-2.466667-1.066666-1.4-0.266667-130-0.533333-285.866667-0.533334l-283.333333-0.066666-6 2.266666c-3.266667 1.266667-6.466667 2.666667-7.066667 3.2-0.533333 0.466667-1.266667 0.866667-1.6 0.866667-1 0-7.266667 4.6-8.666666 6.333333-0.733333 0.866667-2.333333 2.733333-3.466667 4.133334-1.2 1.4-2.2 2.866667-2.2 3.266666s-0.466667 1.133333-1.066667 1.6c-2.333333 2-6.933333 11.866667-6.933333 14.933334 0 0.733333-0.533333 1.866667-1.2 2.6-1.066667 1.2-1.133333 11.266667-1.133333 191.8 0 156.4 0.133333 190.666667 0.866666 191.533333 0.466667 0.533333 1.066667 2.666667 1.266667 4.6s0.933333 4.6 1.6 5.866667 1.8 3.533333 2.533333 5.066666c0.733333 1.466667 2.266667 3.866667 3.4 5.266667 1.066667 1.4 2 2.733333 2 2.933333 0 0.6 7.333333 8.066667 7.933334 8.066667 0.2 0 2 1.2 3.933333 2.666667s3.933333 2.666667 4.466667 2.666666 1 0.333333 1 0.666667c0 0.4 0.6 0.666667 1.333333 0.666667s1.333333 0.266667 1.333333 0.6c0 0.6 1.2 1 8 2.333333 5.8 1.2 559.666667 1.533333 560.4 0.333333z" fill="#bfbfbf" p-id="8767"></path><path d="M454 688c-2.733333-0.4-6.066667-1.133333-7.333333-1.733333-2.8-1.333333-5.733333-2.733333-8-3.933334-0.933333-0.466667-2.8-1.4-4.266667-2.066666-1.4-0.733333-2.666667-1.666667-2.866667-2.066667-0.2-0.466667-0.733333-0.866667-1.133333-0.866667-0.466667 0-1.4-0.533333-2.133333-1.2-0.666667-0.666667-2.6-2.133333-4.266667-3.266666-4.933333-3.466667-11.333333-9.266667-11.333333-10.333334 0-0.266667-1.666667-2.2-3.733334-4.333333s-4.466667-4.933333-5.333333-6.333333c-0.866667-1.333333-1.866667-2.6-2.266667-2.866667-1.466667-0.933333-0.6-3 1.933334-4.6 1.466667-0.933333 2.8-2 3.066666-2.4 0.2-0.333333 1.533333-1.2 2.866667-1.933333 4.4-2.2 6.333333-3.333333 6.733333-3.866667 0.2-0.333333 2.266667-2 4.6-3.733333 2.8-2.133333 4.933333-3.2 6.333334-3.266667 2.533333-0.066667 5.133333 1.133333 5.133333 2.4 0 1 12.6 14.066667 16 16.533333 1.266667 0.933333 3.466667 2.066667 4.866667 2.533334 1.333333 0.4 2.466667 1 2.466666 1.333333 0 1.266667 4.666667 2.333333 10.066667 2.333333 5.2 0 5.866667-0.133333 7.866667-1.8 1.266667-1.133333 2.933333-1.866667 4.133333-1.866666 1.4 0 2.133333-0.466667 2.866667-1.866667 1-2 6.666667-7.466667 8.866666-8.666667 0.733333-0.4 1.866667-1.8 2.466667-3.133333 0.6-1.266667 1.4-2.333333 1.733333-2.333333 0.4 0 0.666667-0.4 0.666667-0.933334s0.466667-1.066667 1-1.333333c0.533333-0.2 1-0.733333 1-1.133333 0-0.466667 0.533333-1.4 1.133333-2.066667 0.6-0.733333 1.2-1.666667 1.266667-2.066667 0.066667-0.466667 1.6-2.866667 3.466667-5.333333s4.266667-6.333333 5.333333-8.666667 2.733333-4.733333 3.733333-5.333333c1.666667-1.133333 1.8-1.066667 3.4 0.333333 0.933333 0.8 1.666667 1.733333 1.666667 2.066667s1.333333 2.666667 3 5.133333 3 4.733333 3 5 0.933333 1.6 2 3c1.133333 1.4 2 2.733333 2 2.933334 0 0.266667 1.133333 1.933333 2.533333 3.8 1.333333 1.866667 2.4 3.666667 2.333334 4-0.2 0.533333 12.8 13.866667 15.266666 15.8 0.666667 0.4 1.533333 0.8 2.066667 0.8 1.2 0 4.466667 1.533333 4.466667 2.2 0 0.266667 0.6 0.466667 1.266666 0.466666 0.733333 0 1.533333 0.333333 1.733334 0.666667 1.133333 1.8 9 0.266667 13.666666-2.6 0.533333-0.333333 2.133333-1.133333 3.466667-1.733333 1.4-0.6 4.733333-3 7.466667-5.333334 2.666667-2.4 5.133333-4.333333 5.4-4.333333 0.6 0 2.4-2 5.666666-6.333333 3.6-4.8 4-5.066667 6.933334-4.266667 1.333333 0.4 2.666667 1.133333 2.866666 1.666667s0.866667 0.933333 1.6 0.933333c0.666667 0 1.466667 0.4 1.733334 0.866667 0.666667 1 3.866667 3.133333 4.866666 3.133333 0.333333 0 1.6 0.933333 2.8 2 1.133333 1.133333 2.533333 2 3.2 2 0.6 0 1.666667 0.533333 2.4 1.2 0.666667 0.6 2.4 1.666667 3.8 2.266667 1.866667 0.933333 2.466667 1.533333 2.466667 2.866666 0 2-4 7.666667-8.466667 12.066667-0.866667 0.8-1.533333 1.666667-1.533333 2 0 0.6-7.266667 7.533333-10.666667 10.133333-1.266667 1-2.466667 1.933333-2.666666 2.2-0.2 0.2-2.133333 1.666667-4.333334 3.333334-2.2 1.6-4.266667 3.266667-4.666666 3.666666-0.733333 0.8-12.6 6.266667-13.6 6.266667-0.333333 0-1.133333 0.466667-1.733334 1.066667-0.933333 0.933333-3.133333 1.133333-15.866666 1.2l-14.8 0.066666-9-4.466666c-4.933333-2.466667-10.066667-5.4-11.333334-6.466667-1.266667-1.133333-3.333333-2.866667-4.533333-3.866667-1.266667-1.066667-2.733333-2.4-3.333333-3.066666-0.666667-0.666667-2.066667-1.933333-3.266667-2.866667l-2.133333-1.6-2.866667 3.066667c-3.2 3.4-10.066667 8.933333-11.133333 8.933333-0.333333 0-0.933333 0.4-1.2 0.933333-0.266667 0.466667-1.733333 1.533333-3.2 2.266667-6.6 3.4-9.466667 4.733333-11.333334 5.2-1.133333 0.266667-2.133333 0.733333-2.333333 1-0.6 0.866667-20.333333 1.266667-26 0.6zM256.133333 531.466667c-0.8-0.8-1.533333-2.733333-1.8-4.6-0.2-1.733333-0.866667-5.133333-1.333333-7.533334-2.4-11.2-3.066667-14.533333-3.4-17.333333-0.2-1.666667-0.6-3.866667-0.933333-5-0.533333-1.8-1.533333-7.466667-2.466667-13.666667-0.2-1.266667-0.6-2.666667-0.933333-3.066666s-0.866667-3-1.266667-5.666667c-0.333333-2.733333-0.8-5.466667-1-6.066667-0.333333-0.8 0.2-1.733333 1.466667-2.8 1.6-1.466667 2.533333-1.666667 6.666666-1.733333 2.6 0 4.933333-0.266667 5.133334-0.6 0.333333-0.533333 3.2-1.066667 8.733333-1.733333 3.533333-0.4 10.6-1.733333 12.733333-2.4 1.133333-0.333333 4.333333-0.866667 7.2-1.266667 2.8-0.333333 5.666667-0.933333 6.4-1.333333 0.666667-0.333333 2.266667-0.666667 3.6-0.666667 1.266667 0 2.533333-0.266667 2.733334-0.666667 0.2-0.333333 1.4-0.666667 2.6-0.666666s2.4-0.2 2.666666-0.466667 1.6-0.533333 2.933334-0.6 3.2-0.266667 4.133333-0.466667c0.933333-0.266667 3.466667-0.733333 5.666667-1.066666 2.2-0.4 4.6-0.866667 5.333333-1s3.466667-0.6 6-1.066667c2.6-0.466667 5-1.066667 5.333333-1.333333 0.4-0.266667 2.666667-0.666667 5.133334-0.866667 2.533333-0.266667 5.133333-0.733333 5.8-1.133333 0.733333-0.333333 2.466667-0.666667 3.866666-0.666667s3.4-0.466667 4.466667-1c1.066667-0.6 2.866667-1 4-0.933333s4-0.4 6.4-1.066667c2.4-0.6 5.4-1.133333 6.666667-1.133333s2.666667-0.266667 3-0.533334c0.4-0.333333 1-0.6 1.333333-0.666666 0.4-0.133333 1-0.266667 1.333333-0.4 0.8-0.2 4.066667-0.8 9-1.533334 2-0.333333 7.133333-1.266667 11.333334-2.066666s8.2-1.533333 8.8-1.6c0.666667-0.066667 1.4-0.333333 1.6-0.6 0.266667-0.266667 1.733333-0.466667 3.266666-0.466667 1.6 0 4.133333-0.466667 5.666667-1 2-0.733333 3.133333-0.8 3.666667-0.333333 0.866667 0.733333 1.066667 1.466667 2.2 9.466666 0.333333 2.4 0.933333 4.8 1.2 5.333334 0.333333 0.466667 0.8 2.533333 1.066666 4.533333 1 6.466667 1.066667 6.933333 1.8 10.666667 1.066667 5.8 1.466667 7.533333 4.666667 23 0.8 3.666667 1.4 7.466667 1.4 8.4s0.266667 1.933333 0.666667 2.333333c0.866667 0.866667-1.2 3.8-2.4 3.333333-0.466667-0.2-1.866667 0.066667-3.066667 0.6-1.266667 0.466667-4.4 1.133333-7.066667 1.333334-2.666667 0.266667-5 0.8-5.2 1.066666-0.2 0.333333-1.333333 0.6-2.533333 0.6s-5 0.6-8.466667 1.333334c-3.466667 0.8-7 1.533333-7.933333 1.666666-5.6 0.933333-10 2.066667-10 2.466667 0 0.333333-1.4 0.533333-3.133333 0.533333-1.8 0.066667-5.133333 0.466667-7.533334 1.066667-3.933333 0.866667-7.866667 1.6-15.666666 2.733333-1.466667 0.2-3.066667 0.666667-3.533334 1.066667-0.466667 0.333333-1 0.466667-1.2 0.266667-0.2-0.133333-1.933333 0.066667-3.8 0.6-1.933333 0.533333-4.4 0.933333-5.6 0.933333-1.133333 0-2.266667 0.266667-2.466666 0.6s-2.4 0.8-4.866667 1.066667c-5.866667 0.666667-6.133333 0.733333-8.866667 1.6-1.266667 0.4-3.466667 0.733333-4.8 0.733333s-2.666667 0.333333-2.866666 0.666667c-0.2 0.4-1.4 0.666667-2.533334 0.666666-1.2 0-3.933333 0.466667-6.133333 1-2.133333 0.6-5 1.2-6.266667 1.4-1.333333 0.133333-3.466667 0.466667-4.733333 0.733334-2.866667 0.533333-4.133333 0.733333-8 1.266666-1.666667 0.2-3.333333 0.666667-3.733333 1s-2.466667 0.733333-4.666667 1c-2.133333 0.266667-5.6 0.866667-7.6 1.466667-2 0.533333-4.533333 1.066667-5.666667 1.133333-1.066667 0.133333-3.066667 0.4-4.333333 0.666667s-2.933333 0.6-3.666667 0.666667c-0.733333 0.133333-2.133333 0.4-3.133333 0.666666-1.266667 0.333333-2.133333 0.066667-3.066667-0.866666zM766 531.666667c-2.4-0.533333-5.066667-1.066667-6-1.266667-4.466667-1.066667-12.333333-2.4-14-2.4-1.066667 0-2.733333-0.333333-3.8-0.8-1-0.4-4.4-1.133333-7.533333-1.6s-7.133333-1.2-9-1.6c-4.933333-1.2-5.666667-1.333333-9.666667-1.933333-2-0.333333-5-0.933333-6.666667-1.266667-1.666667-0.4-8.266667-1.666667-14.666666-2.8s-12.866667-2.4-14.333334-2.733333c-6.2-1.533333-15-3.2-19.466666-3.6-2.666667-0.266667-4.866667-0.733333-4.866667-1s-1.266667-0.666667-2.8-0.866667c-1.6-0.2-3.6-0.533333-4.533333-0.733333-2.733333-0.6-12.2-2.466667-14.333334-2.8-4.6-0.666667-8.933333-1.466667-13.666666-2.466667-2.733333-0.6-7.266667-1.533333-10-2.066667-11.266667-2.266667-12.333333-2.666667-12.533334-4.666666-0.133333-1 0.133333-2.8 0.533334-3.933334 1-2.733333 2.066667-8.6 2.333333-12.8 0.333333-4.2 1.733333-11.2 2.333333-11.666666 0.266667-0.2 0.8-2.4 1.2-5 0.4-2.533333 1.266667-7.066667 1.866667-10s1.266667-6.733333 1.4-8.466667c0.2-1.8 0.533333-3.2 0.8-3.2s0.533333-0.666667 0.6-1.466667c0.133333-2.733333 1.266667-7.866667 1.733333-8.333333 0.266667-0.266667 1-0.133333 1.733334 0.266667 0.666667 0.466667 4.6 1.133333 8.8 1.6 4.133333 0.4 7.866667 1 8.2 1.266666 0.733333 0.6 7.8 2.333333 11.666666 2.933334 1.266667 0.2 3.066667 0.533333 4 0.733333 2.933333 0.666667 8.866667 1.733333 13.533334 2.333333 2.466667 0.333333 5 0.933333 5.666666 1.2 0.6 0.333333 1.533333 0.466667 2 0.266667 0.533333-0.133333 1.6 0 2.333334 0.4 0.8 0.333333 3.6 1 6.133333 1.466667 2.6 0.466667 7.066667 1.4 10 2.066666s6.6 1.266667 8.066667 1.266667c1.533333 0 3.8 0.4 5 0.933333 2.533333 1.066667 8.8 2.066667 11.133333 1.8 0.866667-0.066667 1.866667 0.133333 2.333333 0.466667 0.8 0.6 3 1.266667 6.466667 1.866667 0.933333 0.133333 3.333333 0.6 5.333333 0.933333 2 0.4 4.6 0.733333 5.666667 0.8 1.133333 0 2.333333 0.266667 2.666667 0.533333 0.4 0.266667 1.866667 0.666667 3.333333 0.933334 1.466667 0.2 4.933333 0.866667 7.666667 1.466666 2.733333 0.533333 7.266667 1.4 10 1.933334 2.733333 0.466667 8.733333 1.666667 13.266666 2.6s9.133333 1.733333 10.133334 1.733333c1.066667 0 3.266667 0.4 5 0.8l3.066666 0.866667-0.333333 3.333333c-0.333333 3.466667-0.4 3.8-2.533333 14.333333-0.733333 3.466667-1.733333 8.6-2.266667 11.333334s-1.266667 6.533333-1.666667 8.333333c-0.733333 3.133333-1.6 7.866667-3.6 20.666667-0.4 2.933333-1.333333 6.133333-2 7.2-0.666667 1-1.266667 1.733333-1.333333 1.733333 0-0.066667-2-0.466667-4.4-0.933333z" fill="#bfbfbf" p-id="8768"></path></svg>
           */}
               <IconButton icon={<BiliBiliIcon />} shadow />
            </a>
          </div>
        </div>
        <div>
          <IconButton
            icon={<AddIcon />}
            text={shouldNarrow ? undefined : Locale.Home.NewChat}
            onClick={() => {
              if (config.dontShowMaskSplashScreen) {
                chatStore.newSession();
                navigate(Path.Chat);
              } else {
                navigate(Path.NewChat);
              }
            }}
            shadow
          />
        </div>
      </div>

      <div
        className={styles["sidebar-drag"]}
        onPointerDown={(e) => onDragStart(e as any)}
      >
        <DragIcon />
      </div>
    </div>
  );
}
